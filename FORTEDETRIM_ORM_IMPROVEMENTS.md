# Fortedetrim ORM Report Analysis & Fix

## –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞—Ö
- **–ü—Ä–æ–±–ª–µ–º–∞**: –î–∞–Ω–Ω—ã–µ –æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞—Ö –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –∫–æ–ª–æ–Ω–∫–∞—Ö J (9), K (10), L (11), –Ω–æ —Å–∫—Ä–∏–ø—Ç –∏—Å–∫–∞–ª –∏—Ö –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö
- **–¢–µ–∫—É—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: 173,243 –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
- **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: 3,398,560 –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤

### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –∏—Å—Ö–æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
–ê–Ω–∞–ª–∏–∑ –ø–æ–∫–∞–∑–∞–ª —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
- **–ö–æ–ª–æ–Ω–∫–∞ A (0)**: –¢–∏–ø –∑–∞–ø–∏—Å–∏ ("–û—Ç–∑—ã–≤—ã (–æ—Ç–∑–æ–≤–∏–∫–∏)", "–û—Ç–∑—ã–≤—ã (–∞–ø—Ç–µ–∫–∏)", "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –æ–±—Å—É–∂–¥–µ–Ω–∏—è—Ö")
- **–ö–æ–ª–æ–Ω–∫–∞ B (1)**: URL –ø–ª–æ—â–∞–¥–∫–∏
- **–ö–æ–ª–æ–Ω–∫–∞ C (2)**: –¢–µ–º–∞/–∑–∞–≥–æ–ª–æ–≤–æ–∫ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- **–ö–æ–ª–æ–Ω–∫–∞ E (4)**: –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- **–ö–æ–ª–æ–Ω–∫–∞ G (6)**: –î–∞—Ç–∞ (Excel —Ñ–æ—Ä–º–∞—Ç: 45719, 45720, etc.)
- **–ö–æ–ª–æ–Ω–∫–∞ H (7)**: –ù–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–ö–æ–ª–æ–Ω–∫–∏ J-L (9-11)**: –†–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
  - J (9): –ü—Ä–æ—Å–º–æ—Ç—Ä—ã —Ç–µ–º—ã –Ω–∞ —Å—Ç–∞—Ä—Ç–µ
  - K (10): –ü—Ä–æ—Å–º–æ—Ç—Ä—ã –≤ –∫–æ–Ω—Ü–µ –º–µ—Å—è—Ü–∞  
  - L (11): –ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –ø–æ–ª—É—á–µ–Ω–æ
- **–ö–æ–ª–æ–Ω–∫–∞ M (12)**: –í–æ–≤–ª–µ—á–µ–Ω–∏–µ ("–µ—Å—Ç—å", –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è)
- **–ö–æ–ª–æ–Ω–∫–∞ N (13)**: –¢–∏–ø –∑–∞–ø–∏—Å–∏ ("–û–°", "–¶–°")

### 3. –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```
Row 50: –î–∞—Ç–∞=45719, –ü—Ä–æ—Å–º–æ—Ç—Ä—ã=12000/50600/38600, –í–æ–≤–ª–µ—á–µ–Ω–∏–µ="–µ—Å—Ç—å"
Row 51: –î–∞—Ç–∞=45719, –ü—Ä–æ—Å–º–æ—Ç—Ä—ã=7452/50600/43148
Row 75: –î–∞—Ç–∞=45719, –ü—Ä–æ—Å–º–æ—Ç—Ä—ã=60000/75300/15300
```

## –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
```typescript
// –í —Ñ—É–Ω–∫—Ü–∏–∏ extractRowFromRealStructure
// –°–¢–ê–†–´–ô –ö–û–î:
for (let col = 8; col <= 15; col++) {
  if (row[col] && String(row[col]).trim() !== '') {
    const viewsValue = this.cleanViews(row[col]);
    if (typeof viewsValue === 'number') {
      –ø—Ä–æ—Å–º–æ—Ç—Ä—ã = viewsValue;
      break;
    }
  }
}

// –ù–û–í–´–ô –ö–û–î:
// –ò–∑–≤–ª–µ–∫–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –∫–æ–ª–æ–Ω–æ–∫ J, K, L (9, 10, 11)
let maxViews = 0;
for (let col = 9; col <= 11; col++) {
  if (row[col] && String(row[col]).trim() !== '') {
    const viewsValue = this.cleanViews(row[col]);
    if (typeof viewsValue === 'number' && viewsValue > maxViews) {
      maxViews = viewsValue;
    }
  }
}
–ø—Ä–æ—Å–º–æ—Ç—Ä—ã = maxViews > 0 ? maxViews : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
```

### 2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞—Ç
```typescript
private formatDate(dateValue: any): string {
  if (!dateValue) return '';
  
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ Excel –¥–∞—Ç (45719 = 25.03.2025)
  if (typeof dateValue === 'number' && dateValue > 40000) {
    const date = new Date((dateValue - 25569) * 86400 * 1000);
    return date.toLocaleDateString('ru-RU');
  }
  
  return String(dateValue);
}
```

### 3. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏–π –ø–ª–æ—â–∞–¥–æ–∫
```typescript
private extractPlatformName(url: string): string {
  if (!url) return '';
  
  const url_clean = url.trim().toLowerCase();
  if (url_clean.includes('otzovik.com')) return '–û—Ç–∑–æ–≤–∏–∫';
  if (url_clean.includes('irecommend.ru')) return 'Irecommend';
  if (url_clean.includes('market.yandex.ru')) return '–Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç';
  if (url_clean.includes('dzen.ru')) return '–î–∑–µ–Ω';
  if (url_clean.includes('vk.com')) return '–í–ö–æ–Ω—Ç–∞–∫—Ç–µ';
  if (url_clean.includes('woman.ru')) return 'Woman.ru';
  // ... –∏ —Ç.–¥.
  
  try {
    const domain = new URL(url).hostname;
    return domain.replace('www.', '');
  } catch {
    return url;
  }
}
```

### 4. –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **–û–±—â–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã**: 3,398,560
- **–û—Ç–∑—ã–≤—ã**: 18-22
- **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏**: 519-650  
- **–í–æ–≤–ª–µ—á–µ–Ω–∏–µ**: 20%
- **–ü–ª–æ—â–∞–¥–∫–∏ —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π**: 74%

## –°—Ç–∞—Ç—É—Å
- ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞
- üîÑ –¢—Ä–µ–±—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
1. –û–±–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `extractRowFromRealStructure` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∏—Å—Ö–æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —ç—Ç–∞–ª–æ–Ω—É
4. –ü—Ä–æ–≤–µ—Å—Ç–∏ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ