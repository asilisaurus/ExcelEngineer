/**
 * üß™ –¢–ï–°–¢ –£–õ–£–ß–®–ï–ù–ò–ô GOOGLE APPS SCRIPT
 * –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
 */

function testImprovedProcessor() {
  console.log('üß™ –¢–ï–°–¢ –£–õ–£–ß–®–ï–ù–ò–ô GOOGLE APPS SCRIPT');
  console.log('=' .repeat(60));
  
  try {
    // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
    const processor = new FinalMonthlyReportProcessor();
    
    // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
    const testData = [
      // –°—Ç—Ä–æ–∫–∏ 1-3: –ú–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
      ['–ú–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è 1'],
      ['–ú–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è 2'],
      ['–ú–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è 3'],
      
      // –°—Ç—Ä–æ–∫–∞ 4: –ó–∞–≥–æ–ª–æ–≤–∫–∏
      ['–ü–ª–æ—â–∞–¥–∫–∞', '–°—Å—ã–ª–∫–∞', '–¢–µ–∫—Å—Ç', '–î–∞—Ç–∞', '–ê–≤—Ç–æ—Ä', 'F', 'G', 'H', 'I', 'J', 'K', '–ü—Ä–æ—Å–º–æ—Ç—Ä—ã', '–¢–∏–ø'],
      
      // –°—Ç—Ä–æ–∫–∞ 5: –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏
      ['–û—Ç–∑—ã–≤—ã'],
      
      // –°—Ç—Ä–æ–∫–∏ 6+: –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      ['otzovik.com', 'https://otzovik.com/reviews/fortedetrim/', '–û—Ç–ª–∏—á–Ω—ã–π –≤–∏—Ç–∞–º–∏–Ω D! –ü—Ä–∏–Ω–∏–º–∞—é —É–∂–µ –º–µ—Å—è—Ü, —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è –Ω–∞–º–Ω–æ–≥–æ –ª—É—á—à–µ.', '07.03.2025', '–õ–∏–ª—É—à–∞–Ω', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', 100, '–û–°'],
      ['irecommend.ru', 'https://irecommend.ru/content/fortedetrim', '–í–∏—Ç–∞–º–∏–Ω –î –æ—Ä–≥–∞–Ω–∏–∑–º—É –∏–¥–µ—Ç –Ω–∞ –ø–æ–ª—å–∑—É. –£ –º–µ–Ω—è –ª–∏—à–Ω–∏–π –≤–µ—Å, —Å–∞—Ö–∞—Ä –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ –Ω–æ—Ä–º—ã.', '10.03.2025', 'Marinasmk', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', 150, '–û–°'],
      ['www.otzyvru.com', 'https://www.otzyvru.com/fortedetrim', '–î–æ—Å—Ç–æ–π–Ω—ã–π –≤–∏—Ç–∞–º–∏–Ω –î. –†–∞–±–æ—á–∏–π. –ü—Ä–∏–Ω–∏–º–∞–ª –§–æ—Ä—Ç–µ–¥–µ—Ç—Ä–∏–º 4000 –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é —ç–Ω–¥–æ–∫—Ä–∏–Ω–æ–ª–æ–≥–∞.', '06.03.2025', '–ê–Ω—Ç–æ–Ω –î.', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', 200, '–û–°'],
      
      // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
      ['–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏'],
      
      // –î–∞–Ω–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
      ['otzovik.com', 'https://otzovik.com/comments/fortedetrim/', '–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –æ—Ç–∑—ã–≤, —Å–ø–∞—Å–∏–±–æ –∑–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é!', '08.03.2025', '–ö–æ–º–º–µ–Ω—Ç–∞—Ç–æ—Ä1', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', 50, '–¶–°'],
      ['irecommend.ru', 'https://irecommend.ru/comments/fortedetrim', '–°–æ–≥–ª–∞—Å–µ–Ω —Å –∞–≤—Ç–æ—Ä–æ–º, –ø—Ä–µ–ø–∞—Ä–∞—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π.', '09.03.2025', '–ö–æ–º–º–µ–Ω—Ç–∞—Ç–æ—Ä2', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', 75, '–¶–°'],
      
      // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–π
      ['–û–±—Å—É–∂–¥–µ–Ω–∏—è'],
      
      // –î–∞–Ω–Ω—ã–µ –æ–±—Å—É–∂–¥–µ–Ω–∏–π
      ['forum.ru', 'https://forum.ru/discussion/fortedetrim', '–û–±—Å—É–∂–¥–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤–∏—Ç–∞–º–∏–Ω–∞ D –ø—Ä–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è—Ö.', '11.03.2025', '–£—á–∞—Å—Ç–Ω–∏–∫1', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', 300, '–¶–°'],
      ['vk.com', 'https://vk.com/discussion/fortedetrim', '–ì—Ä—É–ø–ø–∞ –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è –≤–∏—Ç–∞–º–∏–Ω–∞ D –∏ –µ–≥–æ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –∑–¥–æ—Ä–æ–≤—å–µ.', '12.03.2025', '–£—á–∞—Å—Ç–Ω–∏–∫2', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', 250, '–¶–°']
    ];
    
    console.log('üìä –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
    console.log(`üìã –í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫: ${testData.length}`);
    
    // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö
    processor.analyzeDataStructure(testData);
    
    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    const processedData = processor.processData(testData);
    
    console.log('\nüìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –û–ë–†–ê–ë–û–¢–ö–ò:');
    console.log('-' .repeat(40));
    console.log(`üìà –û—Ç–∑—ã–≤—ã: ${processedData.statistics.totalReviews}`);
    console.log(`üí¨ –¶–µ–ª–µ–≤—ã–µ: ${processedData.statistics.totalTargeted}`);
    console.log(`üî• –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ: ${processedData.statistics.totalSocial}`);
    console.log(`üëÄ –í—Å–µ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤: ${processedData.statistics.totalViews}`);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ—Ç–∞–ª–∏
    console.log('\nüìã –î–ï–¢–ê–õ–ò –û–ë–†–ê–ë–û–¢–ö–ò:');
    console.log('–û—Ç–∑—ã–≤—ã:');
    processedData.reviews.forEach((review, i) => {
      console.log(`  ${i + 1}. ${review.platform} - ${review.author} (${review.date})`);
    });
    
    console.log('\n–¶–µ–ª–µ–≤—ã–µ:');
    processedData.targeted.forEach((targeted, i) => {
      console.log(`  ${i + 1}. ${targeted.platform} - ${targeted.author} (${targeted.date})`);
    });
    
    console.log('\n–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ:');
    processedData.social.forEach((social, i) => {
      console.log(`  ${i + 1}. ${social.platform} - ${social.author} (${social.date})`);
    });
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    const expectedReviews = 3;
    const expectedTargeted = 2;
    const expectedSocial = 2;
    
    const isValid = (
      processedData.statistics.totalReviews === expectedReviews &&
      processedData.statistics.totalTargeted === expectedTargeted &&
      processedData.statistics.totalSocial === expectedSocial
    );
    
    console.log('\n‚úÖ –í–ê–õ–ò–î–ê–¶–ò–Ø:');
    console.log(`–û–∂–∏–¥–∞–ª–æ—Å—å: ${expectedReviews}/${expectedTargeted}/${expectedSocial}`);
    console.log(`–ü–æ–ª—É—á–µ–Ω–æ: ${processedData.statistics.totalReviews}/${processedData.statistics.totalTargeted}/${processedData.statistics.totalSocial}`);
    console.log(`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${isValid ? '‚úÖ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù' : '‚ùå –¢–ï–°–¢ –ù–ï –ü–†–û–ô–î–ï–ù'}`);
    
    return {
      success: isValid,
      data: processedData,
      expected: { reviews: expectedReviews, targeted: expectedTargeted, social: expectedSocial }
    };
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
    return { success: false, error: error.toString() };
  }
}

// –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞
function runTest() {
  const result = testImprovedProcessor();
  
  console.log('\nüèÅ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û');
  console.log('=' .repeat(60));
  
  if (result.success) {
    console.log('üéâ –£–õ–£–ß–®–ï–ù–ò–Ø –†–ê–ë–û–¢–ê–Æ–¢ –ö–û–†–†–ï–ö–¢–ù–û!');
    console.log('üöÄ Google Apps Script –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!');
  } else {
    console.log('‚ùå –¢—Ä–µ–±—É—é—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è');
    if (result.error) {
      console.log('–û—à–∏–±–∫–∞:', result.error);
    }
  }
  
  return result;
} 